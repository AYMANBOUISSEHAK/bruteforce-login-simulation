<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Authentification — Brute Force Simulation</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .captcha-container {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            font-size: 1.05em;
        }
        .captcha-container .label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            display: block;
        }
        .captcha-container input {
            width: 120px;
            padding: 8px 12px;
            font-size: 1em;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        .message.success { color: green; font-weight: bold; }
        .message.error   { color: red; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">

    <div class="header">
        <h1>International University of Rabat. UIR</h1>
        <p class="subtitle">Brute Force Login Simulation</p>
    </div>

    <h2>Authentication</h2>

    <form method="POST">
        <input type="text" name="username" placeholder="Username" required>
        <input type="password" name="password" placeholder="Password" required>

        <!-- CAPTCHA TOUJOURS affiché en mode sécurisé -->
        {% if request.args.get('mode') != 'vuln' %}
        <div class="captcha-container">
            <span class="label">Vérifiez que vous n'êtes pas un robot :</span>
            <strong>{{ captcha_question if captcha_question else "Calcul en cours..." }}</strong> =
            <input type="number" name="captcha" placeholder="Réponse" required>
        </div>
        {% endif %}

        <button type="submit">Sign in</button>
    </form>

    {% if message %}
        <p class="message {{ 'success' if 'réussie' in message else 'error' }}">
            {{ message }}
        </p>
    {% endif %}

    <div class="divider"></div>

    <p class="info">
        Total login attempts recorded:
        <strong>{{ attempts }}</strong>
    </p>

    {% if request.args.get('mode') == 'vuln' %}
    <p class="warning">
        ⚠️ Application vulnérable
    </p>
    {% endif %}

</div>

</body>
</html>